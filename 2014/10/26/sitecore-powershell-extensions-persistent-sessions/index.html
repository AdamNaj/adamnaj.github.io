<!DOCTYPE html>
<html lang="en" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1314&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Sitecore PowerShell Extensions Persistent Sessions | Codality</title>
<meta name="description" content="[noun] - \ko-&#39;da-la-te\ - Code and Effect - solving problems with just enough amount of code - by Adam Najmanowicz">
<meta name="generator" content="Hugo 0.156.0">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;700&family=Alegreya+Sans:ital,wght@0,300;0,400;0,700;1,300;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/syntax.css">

<script>
  (function(){var s=localStorage.getItem('theme-preference');var t=s==='dark'||s==='light'?s:(window.matchMedia('(prefers-color-scheme:dark)').matches?'dark':'light');document.documentElement.setAttribute('data-theme',t)})();
</script>

      <script src="/js/main.js"></script>



</head>
<body>
  <div class="site-wrapper">
    <header class="site-header">
      <div class="header-inner">
  <div class="header-top">
    <nav class="site-navigation" aria-label="Main Navigation">
      
  <nav>
    <ul>
    <li>
      <a href="/">Home</a>
    </li>
    <li>
      <a href="/about/">About me</a>
    </li>
    <li>
      <a href="/downloads/">Downloads</a>
    </li>
    </ul>
  </nav>

    </nav>
    
    <nav class="social-navigation" aria-label="Social Links">
      <ul>
        <li><a href="https://github.com/AdamNaj" title="GitHub"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2z"/></svg></a></li>
        <li><a href="https://www.linkedin.com/in/najmanowicz/" title="LinkedIn"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"/></svg></a></li>
        <li><a href="http://www.twitter.com/AdamNaj" title="Twitter"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"/></svg></a></li>
        <li><a href="https://www.facebook.com/adam.najmanowicz" title="Facebook"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-2c-.55 0-1 .45-1 1v2h3v3h-3v6.95c5.05-.5 9-4.76 9-9.95z"/></svg></a></li>
        <li><a href="https://www.instagram.com/adamnajmanowicz/" title="Instagram"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 0 1-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 0 1 7.8 2m-.2 2A3.6 3.6 0 0 0 4 7.6v8.8C4 18.39 5.61 20 7.6 20h8.8a3.6 3.6 0 0 0 3.6-3.6V7.6C20 5.61 18.39 4 16.4 4H7.6m9.65 1.5a1.25 1.25 0 0 1 1.25 1.25A1.25 1.25 0 0 1 17.25 8 1.25 1.25 0 0 1 16 6.75a1.25 1.25 0 0 1 1.25-1.25M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3z"/></svg></a></li>
      </ul>
    </nav>
    
    <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode" title="Toggle dark mode">
      <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
      <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
    </button>
  </div>
  <div class="site-branding">
    <p class="site-title"><a href="/">Codality</a></p>
    
    <p class="site-tagline">[noun] - \ko-&#39;da-la-te\ - Code and Effect - solving problems with just enough amount of code - by Adam Najmanowicz</p>
    
    <hr class="header-separator"><nav class="tag-cloud" aria-label="Category Cloud"><a href="/categories/best-practices/" style="font-size: 14px;" title="best practices (14 posts)">Best Practices</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/blog-navigator/" style="font-size: 12px;" title="blog navigator (8 posts)">Blog Navigator</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/cms/" style="font-size: 24px;" title="cms (79 posts)">CMS</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/cms-ux/" style="font-size: 12px;" title="cms ux (8 posts)">CMS UX</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/code-samples/" style="font-size: 16px;" title="code samples (35 posts)">Code Samples</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/continuous-deployment/" style="font-size: 11px;" title="continuous deployment (4 posts)">Continuous Deployment</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/desktop-customization/" style="font-size: 11px;" title="desktop customization (4 posts)">Desktop Customization</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/downloadable/" style="font-size: 14px;" title="downloadable (22 posts)">Downloadable</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/epicode/" style="font-size: 14px;" title="epicode (16 posts)">EPiCode</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/episerver/" style="font-size: 18px;" title="episerver (41 posts)">EPiServer</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/faceted-navigation/" style="font-size: 11px;" title="faceted navigation (5 posts)">Faceted Navigation</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/icondeveloper/" style="font-size: 11px;" title="icondeveloper (3 posts)">IconDeveloper</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/internet-information-services/" style="font-size: 12px;" title="internet information services (11 posts)">Internet Information Services</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/lifestyle/" style="font-size: 14px;" title="lifestyle (13 posts)">Lifestyle</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/microsoft-sqlserver/" style="font-size: 12px;" title="microsoft sqlserver (6 posts)">Microsoft SqlServer</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/mobile/" style="font-size: 11px;" title="mobile (4 posts)">Mobile</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/open-source/" style="font-size: 16px;" title="open source (24 posts)">Open Source</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/powershell/" style="font-size: 18px;" title="powershell (43 posts)">PowerShell</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/rants/" style="font-size: 12px;" title="rants (7 posts)">Rants</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/scripting/" style="font-size: 18px;" title="scripting (43 posts)">Scripting</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/security/" style="font-size: 11px;" title="security (2 posts)">Security</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/sitecore/" style="font-size: 18px;" title="sitecore (38 posts)">Sitecore</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/skinning/" style="font-size: 12px;" title="skinning (10 posts)">Skinning</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/skinstudio/" style="font-size: 14px;" title="skinstudio (13 posts)">SkinStudio</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/software-development/" style="font-size: 28px;" title="software development (99 posts)">Software Development</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/solution/" style="font-size: 18px;" title="solution (42 posts)">Solution</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/stardock/" style="font-size: 16px;" title="stardock (25 posts)">Stardock</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/tooling/" style="font-size: 14px;" title="tooling (13 posts)">Tooling</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/visual-studio/" style="font-size: 12px;" title="visual studio (7 posts)">Visual Studio</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/webparts/" style="font-size: 11px;" title="webparts (2 posts)">WebParts</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/windowblinds/" style="font-size: 12px;" title="windowblinds (12 posts)">WindowBlinds</a></nav>
    <hr class="tag-cloud-separator"></div>
</div>

    </header>
    <div class="site-main">
      <aside class="sidebar">
  <div class="widget">
    <h2 class="widget-title">Search</h2>
    <form class="search-form" action="http://localhost:1314/search/" method="get">
      <input type="search" class="search-field" placeholder="Search ..." name="q">
    </form>
  </div>

  
  <div class="widget widget-mvp">
    <a href="https://mvp.sitecore.com/en/Directory/Profile?id=e416ef1dabf5468ff4fa08dd30f068bb" title="Sitecore Technology MVP 2026">
      <img src="/images/sitecore-mvp-2026-technology.png" alt="Sitecore Technology MVP 2026" class="mvp-badge" width="250">
    </a>
    
    <div class="mvp-badges-history">
      
      
      
      <div class="mvp-badge-item">
        <img src="/images/mvp/2017-Technology.png" alt="MVP Badge 2017" class="mvp-badge-small">
        <span class="mvp-badge-year">2017</span>
      </div>
      
      
      
      <div class="mvp-badge-item">
        <img src="/images/mvp/2016-Technology.png" alt="MVP Badge 2016" class="mvp-badge-small">
        <span class="mvp-badge-year">2016</span>
      </div>
      
      
      
      <div class="mvp-badge-item">
        <img src="/images/mvp/2015-Technology.png" alt="MVP Badge 2015" class="mvp-badge-small">
        <span class="mvp-badge-year">2015</span>
      </div>
      
      
      
      <div class="mvp-badge-item">
        <img src="/images/mvp/2014-Technology.png" alt="MVP Badge 2014" class="mvp-badge-small">
        <span class="mvp-badge-year">2014</span>
      </div>
      
      
      
      <div class="mvp-badge-item">
        <img src="/images/mvp/2013-Technology.png" alt="MVP Badge 2013" class="mvp-badge-small">
        <span class="mvp-badge-year">2013</span>
      </div>
      
      
      
      <div class="mvp-badge-item">
        <img src="/images/mvp/2012-Technology.png" alt="MVP Badge 2012" class="mvp-badge-small">
        <span class="mvp-badge-year">2012</span>
      </div>
      
      
      
      <div class="mvp-badge-item">
        <img src="/images/mvp/2011-Technology.png" alt="MVP Badge 2011" class="mvp-badge-small">
        <span class="mvp-badge-year">2011</span>
      </div>
      
    </div>
    
  </div>
  

  
</aside>

      <main class="content-area">
        
  <article class="post single">
    <div class="content-area">
      <header class="entry-header">
        <h1 class="entry-title">Sitecore PowerShell Extensions Persistent Sessions</h1>
        <div class="entry-meta">
          <time datetime="2014-10-26T21:02:20&#43;00:00">
            October 26, 2014
          </time>
          
          <span class="author">by Adam Najmanowicz</span>
          
          <span class="reading-time">
            <svg class="reading-time-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
            8 min read
          </span>
        </div>
        
        <div class="entry-categories">
          
          <a href="http://localhost:1314/categories/best-practices/" class="category-badge">Best Practices</a>
          
          <a href="http://localhost:1314/categories/cms/" class="category-badge">CMS</a>
          
          <a href="http://localhost:1314/categories/code-samples/" class="category-badge">Code Samples</a>
          
          <a href="http://localhost:1314/categories/powershell/" class="category-badge">PowerShell</a>
          
          <a href="http://localhost:1314/categories/scripting/" class="category-badge">Scripting</a>
          
          <a href="http://localhost:1314/categories/sitecore/" class="category-badge">Sitecore</a>
          
          <a href="http://localhost:1314/categories/software-development/" class="category-badge">Software Development</a>
          
          <a href="http://localhost:1314/categories/solution/" class="category-badge">Solution</a>
          
        </div>
        
      </header>

      <div class="entry-content">
        <p><a href="/images/coach_time_out_400_clr_4749.png"><img src="/images/coach_time_out_400_clr_4749_thumb.png" alt="coach_time_out_400_clr_4749" title="coach_time_out_400_clr_4749" class="alignleft" width="300" height="400" /></a></p>
<p>If you&rsquo;re reading this, chances are you&rsquo;ve probably read about the ways of putting scripts in the <a href="/2011/11/24/extending-sitecore-ribbon-with-powershell-scripts/">Content Editor ribbon</a> or <a href="/2011/11/22/context-powershell-scripts-for-sitecore/">Context Menu</a>. Those are some simple and quick ways of extending the Sitecore UI to do quick actions accessible for your users without them having to even know about the existence of PowerShell in your system. Up until now however we&rsquo;ve not been very vocal about the fact that those does not really have to be quick one-off actions but they can indeed form a broader solution to your problem through the use of persistent, named sessions. In fact Sitecore PowerShell Extensions (SPE) allow you to manage sessions and decide that it should stay in memory after the script have executed. In fact SPE does quite a bit of session maintenance itself that you might want to be aware of.</p>
<h2 id="what-do-i-really-need-to-know-about-script-sessions">What do I really need to know about script sessions?</h2>
<p>ScriptSession is an object that encapsulates a PowerShell Runspace. Whenever you decide to run a script 2 things will happen:</p>
<ul>
<li>a ScriptSession is requested from the SessionManager (which either creates a new session or recovers an existing named session)</li>
<li>after which it&rsquo;s being used to execute your script in either the current thread or a new Sitecore Job is being instantiated and the Script session is passed to it for execution.</li>
</ul>
<p>This is decided internally based on what you&rsquo;re using a Session for unless you&rsquo;re instantiating it directly (<a href="/2012/04/06/using-powershell-console-for-sitecore-in-your-own-code/">like described in this post</a>) in which case you&rsquo;re responsible for disposing it.
After the script is executed and the Job has ended the session is discarded unless your script has a <em><strong>Persistent Session ID</strong></em> which I will show you how to define in just a moment.</p>
<h2 id="great-so-there-are-sessions-but-what-are-they-good-for">Great so there are sessions? but what are they good for?</h2>
<p>Let&rsquo;s see how this works based on 2 scripts I&rsquo;ve added to SPE some time ago that allow you to copy Layout data from one item to another. You can find those scripts in the Content Editor/Context Menu/Layout/ library:</p>
<p><a href="/images/image11.png"><img src="/images/image_thumb11.png" alt="image" title="image" class="aligncenter" width="399" height="391" /></a></p>
<p>If you open the <em><strong>Copy Renderings</strong></em> script you can see that it&rsquo;s extremely simple and it&rsquo;s not quite apparent what it does on its own until you understand that it&rsquo;s a part of a bigger solution that spans across 2 scripts. I&rsquo;ve added some comments to make it more understandable for the purpose of this post:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c">#get the item for which the script was executed</span>
</span></span><span class="line"><span class="cl"><span class="nv">$sourceItem</span> <span class="p">=</span> <span class="nb">get-item</span> <span class="p">.</span>
</span></span><span class="line"><span class="cl"><span class="c">#assign rendering to a variable - we will need it in the other script</span>
</span></span><span class="line"><span class="cl"><span class="nv">$renderings</span> <span class="p">=</span> <span class="nv">$sourceItem</span><span class="p">.</span><span class="n">__Renderings</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c">#remember the path of this item just for reporting purposes in the second script</span>
</span></span><span class="line"><span class="cl"><span class="nv">$sourceName</span> <span class="p">=</span> <span class="nv">$sourceItem</span><span class="p">.</span><span class="n">ProviderPath</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="c">#write a status to the script output that we&#39;ve copied the layout</span>
</span></span><span class="line"><span class="cl"><span class="nb">write-host</span> <span class="s2">&#34;Rendering copied from </span><span class="p">$(</span><span class="nv">$sourceName</span><span class="p">)</span><span class="s2">&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now this script does nothing other than copy the layout information from the current item into a $renderings variable. The secret sauce is in the script settings. If you open the runtime settings of the script:</p>
<p><a href="/images/image12.png"><img src="/images/image_thumb12.png" alt="image" title="image" class="aligncenter" width="861" height="446" /></a></p>
<p>You will see that the script has a <em><strong>Persistent Session ID</strong></em> set on it. Which make the session that&rsquo;s running it stay resident upon script termination:</p>
<p><a href="/images/image23.png"><img src="/images/image_thumb23.png" alt="image" title="image" class="aligncenter" width="736" height="770" /></a></p>
<p>Another cool thing that I wanted you to notice in the above screenshot is the <em><strong>Enable rules</strong></em> field which (in this case) will show the script as disabled if the item you&rsquo;ve tried to execute it for has no layout. This setting is available for both scripts and script library items (that contain other scripts). So the following can be result of properly using those:</p>
<p><a href="/images/image15.png"><img src="/images/image_thumb15.png" alt="image" title="image" class="aligncenter" width="863" height="384" /></a></p>
<p>While <em><strong>Enable rules</strong></em> field allows you to disable a menu item the <em><strong>Show rules</strong></em> field allows you to hide them altogether to avoid clutter in the Scripts context menu if you&rsquo;re having a lot of them.
The above setting of the <em><strong>Persistent Session ID</strong></em> will cause the PowerShell Runspace to be kept for future reuse whenever a script with the same <em><strong>Persistent Session ID</strong></em> will be executed. Such consecutive script will have access to all the previously set variables. Let&rsquo;s look at the <em><strong>Paste renderings</strong></em> script then to see how this would be used:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c">#get the item to which we want to paste the renderings from the source item</span>
</span></span><span class="line"><span class="cl"><span class="nv">$targetItem</span> <span class="p">=</span> <span class="nb">get-item</span> <span class="p">.</span>
</span></span><span class="line"><span class="cl"><span class="c">#get the item path for printing it later</span>
</span></span><span class="line"><span class="cl"><span class="nv">$targetName</span> <span class="p">=</span> <span class="nv">$targetItem</span><span class="p">.</span><span class="n">ProviderPath</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c">#assign the renderings that we&#39;ve recorded in the previous script</span>
</span></span><span class="line"><span class="cl"><span class="nv">$targetItem</span><span class="p">.</span><span class="py">__Renderings</span> <span class="p">=</span> <span class="nv">$renderings</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c">#Write what you&#39;ve done</span>
</span></span><span class="line"><span class="cl"><span class="nb">write-host</span> <span class="s2">&#34;Renderings pasted from &#39;</span><span class="p">$(</span><span class="nv">$sourceName</span><span class="p">)</span><span class="s2">&#39; to &#39;</span><span class="p">$(</span><span class="nv">$targetName</span><span class="p">)</span><span class="s2">&#39;&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can see that the $renderings variable is not initialized anywhere in this script. That&rsquo;s not necessary because we did this in the previous script and it indeed persisted! Let&rsquo;s look at this script runtime settings then to see how you can achieve this?</p>
<p><a href="/images/image16.png"><img src="/images/image_thumb16.png" alt="image" title="image" class="aligncenter" width="629" height="687" /></a></p>
<p>You can see that the <em><strong>Persistent Session ID</strong></em> is the same as in the previous script therefore it will get executed in the same runspace and thus we&rsquo;ll get access to the previous script variables. More than that though - you see that the script <em><strong>Enable rule</strong></em> requires that a session with our selected <em><strong>Persistent Session ID</strong></em> already exist for the menu item to be enabled in the context menu. Which is desirable as if you haven&rsquo;t copied anything at first &ndash; the required $renderings variable would not be initialized yet and the script would not be able to perform its job. That is why in the above context menu screenshot the <em><strong>Paste Renderings</strong></em> item was disabled. Once we execute the <em><strong>Copy renderings</strong></em> script from the menu the session with the <em><strong>renderingCopySession</strong></em> ID will be present in SessionManager and this script will become enabled:</p>
<p><a href="/images/image17.png"><img src="/images/image_thumb17.png" alt="image" title="image" class="aligncenter" width="391" height="370" /></a></p>
<p>SPE comes with a few rules that allow you for rich definition of when items are enabled or disabled:</p>
<p><a href="/images/image18.png"><img src="/images/image_thumb18.png" alt="image" title="image" class="aligncenter" width="639" height="537" /></a></p>
<p>The first rule on the above list will be explained in one of the upcoming posts, the second we&rsquo;ve just used. Now the third rule on the above list is going a bit further then the second one. It checks not only whether the session with a specific <em><strong>Persistent Session ID</strong></em> exists but also that it has a specifically named variable within the session defined. This way you can steer whether some options appear or not in the menu from your scripts by defining variables in your scripts.</p>
<h2 id="how-else-a-session-can-become-persistent">How else a session can become persistent?</h2>
<p>There is one built-in scenario when a session needs to become persistent &ndash; that is when you use the PowerShell Console:</p>
<p><a href="/images/image19.png"><img src="/images/image_thumb19.png" alt="image" title="image" class="aligncenter" width="650" height="968" /></a></p>
<p>This is because the Console enables you to keep continuity between the commands you execute and in fact is handled completely differently than the other interactions &ndash; through a web service.</p>
<h2></h2>
<h2 id="how-do-i-keep-them-sessions-in-moderation">How do I keep them sessions in moderation?</h2>
<p>With the sessions potentially staying in memory how do we keep it under control?
Well the good news is that every persistent Runspace/ScriptSession will be removed from memory automatically within half an hour <em><strong>after it&rsquo;s been last used</strong></em>. They will expire and get removed after that time. The Console again is a special case &ndash; if you keep the window open it will ping the server to keep the session alive as long as the windows is on, the session will be collected after half an hour of closing the Console window to give you a chance to re-connect to it if it was closed by mistake.
If you want to see which sessions are alive you can run the <em><strong>PowerShell Background Session Manager</strong></em> available in the <em><strong>PowerShell Toolbox</strong></em> in the <em><strong>Sitecore</strong></em> menu:</p>
<p><a href="/images/image20.png"><img src="/images/image_thumb20.png" alt="image" title="image" class="aligncenter" width="619" height="601" /></a></p>
<p>Which will allow you to kill sessions and connect to them.</p>
<p><a href="/images/image21.png"><img src="/images/image_thumb21.png" alt="image" title="image" class="aligncenter" width="824" height="387" /></a></p>
<p>If you connect to an existing session you can have access to all the variables to e.g. debug a named session or diagnose their variable values. For example I can connect to the session with our <em><strong>renderingCopySession</strong></em> ID and check the value of the Runspace variables:</p>
<p><a href="/images/image22.png"><img src="/images/image_thumb22.png" alt="image" title="image" class="aligncenter" width="650" height="345" /></a></p>
<p>As you can see above it even retained and printed the output for me when I opened it and when I typed $renderings it shown me the value of the variable.</p>
<h2 id="do-you-have-any-other-example-of-persistent-session-usage">Do you have any other example of persistent session usage?</h2>
<p>You might want to check out the <em><strong>Packaging</strong></em> scripts which are another OOTB Example of Persistent Sessions usage.</p>
<p><a href="/images/image24.png"><img src="/images/image_thumb24.png" alt="image" title="image" class="aligncenter" width="385" height="483" /></a></p>
<h2></h2>
<h2 id="what-should-i-be-mindful-of">What should I be mindful of?</h2>
<p>An important thing to remember is that whatever is stored in variables in the session you&rsquo;re keeping in memory is staying in memory for the duration of the session. Therefore it&rsquo;s best practice to keep as little in them as possible. This means that if you&rsquo;re using global PS variables you might consider clearing those by assigning $null to those that are not needed between the calls to a persistent session.
The sessions with persistent ID do not mix between different user sessions. If you&rsquo;ll login to a different browser it will not retain your state from the other browser as the sitecore session is part of the internally used session key.
You can still see all users sessions and all your sessions from different browser in the Session Manager. You can also connect to all of them, so probably storing a sensitive user data in them is not a good idea.
That is all really that is to it &ndash; now with those session management basics laid out we will be able to move into using them to create more exciting scenarios with them in the following posts.
Happy scripting!</p>

      </div>

      <footer class="entry-footer">
        

        <nav class="post-navigation">
          
          <div class="nav-previous">
            <a href="/2014/10/25/creating-beautiful-sitecore-reports-easily-with-powershell-extensions/">&laquo; Creating beautiful Sitecore reports easily with PowerShell Extensions</a>
          </div>
          
          
          <div class="nav-next">
            <a href="/2014/11/01/sitecore-powershell-extensions-3-0-modules-proposal/">Sitecore PowerShell Extensions 3.0 Modules &raquo;</a>
          </div>
          
        </nav>
      </footer>

      
<div class="comments">
  <h2 class="comments-title">Comments</h2>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = "http://localhost:1314/2014/10/26/sitecore-powershell-extensions-persistent-sessions/";
      this.page.identifier = "/2014/10/26/sitecore-powershell-extensions-persistent-sessions/";
      this.page.identifier = '3160883544';
    };
    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://codality.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

    </div>
  </article>

      </main>
    </div>
    <footer class="site-footer">
      <div class="footer-inner">
  <p>&copy; 1999-2026 - <a href="/">Adam Najmanowicz</a></p>
  
</div>

    </footer>
  </div>
  <button class="back-to-top" id="back-to-top" aria-label="Back to top" title="Back to top">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"/></svg>
  </button>
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.highlight').forEach(function(block) {
      block.style.position = 'relative';
      var btn = document.createElement('button');
      btn.className = 'copy-btn';
      btn.setAttribute('aria-label', 'Copy code');
      btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>';
      block.appendChild(btn);
      btn.addEventListener('click', function() {
        var code = block.querySelector('td:last-child code') || block.querySelector('code');
        if (code) {
          navigator.clipboard.writeText(code.textContent).then(function() {
            btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>';
            setTimeout(function() {
              btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>';
            }, 2000);
          });
        }
      });
    });
  });
  </script>
  <script>
  (function() {
    var btn = document.getElementById('back-to-top');
    if (!btn) return;
    var visible = false;
    window.addEventListener('scroll', function() {
      var shouldShow = window.scrollY > 400;
      if (shouldShow !== visible) {
        visible = shouldShow;
        btn.classList.toggle('visible', visible);
      }
    }, { passive: true });
    btn.addEventListener('click', function() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  })();
  </script>
  <div class="lightbox-overlay" id="lightbox">
    <button class="lightbox-close" id="lightbox-close" aria-label="Close lightbox">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
    </button>
    <div class="lightbox-content" id="lightbox-content"></div>
  </div>
  <script>
  (function() {
    var overlay = document.getElementById('lightbox');
    var content = document.getElementById('lightbox-content');
    var closeBtn = document.getElementById('lightbox-close');
    var imgExts = /\.(jpe?g|png|gif|webp|svg|bmp|avif)(\?.*)?$/i;
    var vidExts = /\.(mp4|webm|ogg)(\?.*)?$/i;

    function open(href) {
      content.innerHTML = '';
      if (imgExts.test(href)) {
        var img = document.createElement('img');
        img.src = href;
        img.alt = '';
        content.appendChild(img);
      } else if (vidExts.test(href)) {
        var vid = document.createElement('video');
        vid.src = href;
        vid.controls = true;
        vid.autoplay = true;
        content.appendChild(vid);
      } else {
        return false;
      }
      overlay.classList.add('active');
      document.body.style.overflow = 'hidden';
      return true;
    }

    function close() {
      overlay.classList.remove('active');
      document.body.style.overflow = '';
      var vid = content.querySelector('video');
      if (vid) vid.pause();
    }

    document.addEventListener('click', function(e) {
      var link = e.target.closest('a[href]');
      if (!link) return;
      var href = link.getAttribute('href');
      if (imgExts.test(href) || vidExts.test(href)) {
        e.preventDefault();
        open(href);
      }
    });

    closeBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      close();
    });

    overlay.addEventListener('click', function(e) {
      if (e.target === overlay) close();
    });

    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && overlay.classList.contains('active')) close();
    });
  })();
  </script>
  <script id="dsq-count-scr" src="https://codality.disqus.com/count.js" async></script>
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    var mermaidBlocks = document.querySelectorAll('pre > code.language-mermaid');
    if (mermaidBlocks.length > 0) {
      var s = document.createElement('script');
      s.src = 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js';
      s.onload = function() {
        var mermaidTheme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default';
        mermaid.initialize({ startOnLoad: false, theme: mermaidTheme });
        mermaidBlocks.forEach(function(block) {
          var pre = block.parentElement;
          var div = document.createElement('div');
          div.className = 'mermaid';
          div.textContent = block.textContent;
          pre.parentNode.replaceChild(div, pre);
        });
        mermaid.run();
      };
      document.head.appendChild(s);
    }
  });
  </script>
</body>
</html>
