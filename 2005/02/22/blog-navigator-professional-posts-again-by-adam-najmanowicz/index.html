<!DOCTYPE html>
<html lang="en" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1314&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Blog Navigator Professional posts again | Codality</title>
<meta name="description" content="[noun] - \ko-&#39;da-la-te\ - Code and Effect - solving problems with just enough amount of code - by Adam Najmanowicz">
<meta name="generator" content="Hugo 0.156.0">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;700&family=Alegreya+Sans:ital,wght@0,300;0,400;0,700;1,300;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/syntax.css">

<script>
  (function(){var s=localStorage.getItem('theme-preference');var t=s==='dark'||s==='light'?s:(window.matchMedia('(prefers-color-scheme:dark)').matches?'dark':'light');document.documentElement.setAttribute('data-theme',t)})();
</script>

      <script src="/js/main.js"></script>



</head>
<body>
  <div class="site-wrapper">
    <header class="site-header">
      <div class="header-inner">
  <div class="header-top">
    <nav class="site-navigation" aria-label="Main Navigation">
      
  <nav>
    <ul>
    <li>
      <a href="/">Home</a>
    </li>
    <li>
      <a href="/about/">About me</a>
    </li>
    <li>
      <a href="/downloads/">Downloads</a>
    </li>
    </ul>
  </nav>

    </nav>
    
    <nav class="social-navigation" aria-label="Social Links">
      <ul>
        <li><a href="https://github.com/AdamNaj" title="GitHub"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2z"/></svg></a></li>
        <li><a href="https://www.linkedin.com/in/najmanowicz/" title="LinkedIn"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"/></svg></a></li>
        <li><a href="http://www.twitter.com/AdamNaj" title="Twitter"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"/></svg></a></li>
        <li><a href="https://www.facebook.com/adam.najmanowicz" title="Facebook"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-2c-.55 0-1 .45-1 1v2h3v3h-3v6.95c5.05-.5 9-4.76 9-9.95z"/></svg></a></li>
        <li><a href="https://www.instagram.com/adamnajmanowicz/" title="Instagram"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 0 1-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 0 1 7.8 2m-.2 2A3.6 3.6 0 0 0 4 7.6v8.8C4 18.39 5.61 20 7.6 20h8.8a3.6 3.6 0 0 0 3.6-3.6V7.6C20 5.61 18.39 4 16.4 4H7.6m9.65 1.5a1.25 1.25 0 0 1 1.25 1.25A1.25 1.25 0 0 1 17.25 8 1.25 1.25 0 0 1 16 6.75a1.25 1.25 0 0 1 1.25-1.25M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3z"/></svg></a></li>
      </ul>
    </nav>
    
    <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode" title="Toggle dark mode">
      <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
      <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
    </button>
  </div>
  <div class="site-branding">
    <p class="site-title"><a href="/">Codality</a></p>
    
    <p class="site-tagline">[noun] - \ko-&#39;da-la-te\ - Code and Effect - solving problems with just enough amount of code - by Adam Najmanowicz</p>
    
    <hr class="header-separator"><nav class="tag-cloud" aria-label="Category Cloud"><a href="/categories/best-practices/" style="font-size: 14px;" title="best practices (14 posts)">Best Practices</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/blog-navigator/" style="font-size: 12px;" title="blog navigator (8 posts)">Blog Navigator</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/cms/" style="font-size: 24px;" title="cms (79 posts)">CMS</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/cms-ux/" style="font-size: 12px;" title="cms ux (8 posts)">CMS UX</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/code-samples/" style="font-size: 16px;" title="code samples (35 posts)">Code Samples</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/continuous-deployment/" style="font-size: 11px;" title="continuous deployment (4 posts)">Continuous Deployment</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/desktop-customization/" style="font-size: 11px;" title="desktop customization (4 posts)">Desktop Customization</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/downloadable/" style="font-size: 14px;" title="downloadable (22 posts)">Downloadable</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/epicode/" style="font-size: 14px;" title="epicode (16 posts)">EPiCode</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/episerver/" style="font-size: 18px;" title="episerver (41 posts)">EPiServer</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/faceted-navigation/" style="font-size: 11px;" title="faceted navigation (5 posts)">Faceted Navigation</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/icondeveloper/" style="font-size: 11px;" title="icondeveloper (3 posts)">IconDeveloper</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/internet-information-services/" style="font-size: 12px;" title="internet information services (11 posts)">Internet Information Services</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/lifestyle/" style="font-size: 14px;" title="lifestyle (13 posts)">Lifestyle</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/microsoft-sqlserver/" style="font-size: 12px;" title="microsoft sqlserver (6 posts)">Microsoft SqlServer</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/mobile/" style="font-size: 11px;" title="mobile (4 posts)">Mobile</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/open-source/" style="font-size: 16px;" title="open source (24 posts)">Open Source</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/powershell/" style="font-size: 18px;" title="powershell (43 posts)">PowerShell</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/rants/" style="font-size: 12px;" title="rants (7 posts)">Rants</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/scripting/" style="font-size: 18px;" title="scripting (43 posts)">Scripting</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/security/" style="font-size: 11px;" title="security (2 posts)">Security</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/sitecore/" style="font-size: 18px;" title="sitecore (38 posts)">Sitecore</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/skinning/" style="font-size: 12px;" title="skinning (10 posts)">Skinning</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/skinstudio/" style="font-size: 14px;" title="skinstudio (13 posts)">SkinStudio</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/software-development/" style="font-size: 28px;" title="software development (99 posts)">Software Development</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/solution/" style="font-size: 18px;" title="solution (42 posts)">Solution</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/stardock/" style="font-size: 16px;" title="stardock (25 posts)">Stardock</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/tooling/" style="font-size: 14px;" title="tooling (13 posts)">Tooling</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/visual-studio/" style="font-size: 12px;" title="visual studio (7 posts)">Visual Studio</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/webparts/" style="font-size: 11px;" title="webparts (2 posts)">WebParts</a><span class="tag-cloud-sep" aria-hidden="true">&middot;</span><a href="/categories/windowblinds/" style="font-size: 12px;" title="windowblinds (12 posts)">WindowBlinds</a></nav>
    <hr class="tag-cloud-separator"></div>
</div>

    </header>
    <div class="site-main">
      <aside class="sidebar">
  <div class="widget">
    <h2 class="widget-title">Search</h2>
    <form class="search-form" action="http://localhost:1314/search/" method="get">
      <input type="search" class="search-field" placeholder="Search ..." name="q">
    </form>
  </div>

  
  <div class="widget widget-mvp">
    <a href="https://mvp.sitecore.com/en/Directory/Profile?id=e416ef1dabf5468ff4fa08dd30f068bb" title="Sitecore Technology MVP 2026">
      <img src="/images/sitecore-mvp-2026-technology.png" alt="Sitecore Technology MVP 2026" class="mvp-badge" width="250">
    </a>
    
    <div class="mvp-badges-history">
      
      
      
      <div class="mvp-badge-item">
        <img src="/images/mvp/2017-Technology.png" alt="MVP Badge 2017" class="mvp-badge-small">
        <span class="mvp-badge-year">2017</span>
      </div>
      
      
      
      <div class="mvp-badge-item">
        <img src="/images/mvp/2016-Technology.png" alt="MVP Badge 2016" class="mvp-badge-small">
        <span class="mvp-badge-year">2016</span>
      </div>
      
      
      
      <div class="mvp-badge-item">
        <img src="/images/mvp/2015-Technology.png" alt="MVP Badge 2015" class="mvp-badge-small">
        <span class="mvp-badge-year">2015</span>
      </div>
      
      
      
      <div class="mvp-badge-item">
        <img src="/images/mvp/2014-Technology.png" alt="MVP Badge 2014" class="mvp-badge-small">
        <span class="mvp-badge-year">2014</span>
      </div>
      
      
      
      <div class="mvp-badge-item">
        <img src="/images/mvp/2013-Technology.png" alt="MVP Badge 2013" class="mvp-badge-small">
        <span class="mvp-badge-year">2013</span>
      </div>
      
      
      
      <div class="mvp-badge-item">
        <img src="/images/mvp/2012-Technology.png" alt="MVP Badge 2012" class="mvp-badge-small">
        <span class="mvp-badge-year">2012</span>
      </div>
      
      
      
      <div class="mvp-badge-item">
        <img src="/images/mvp/2011-Technology.png" alt="MVP Badge 2011" class="mvp-badge-small">
        <span class="mvp-badge-year">2011</span>
      </div>
      
    </div>
    
  </div>
  

  
</aside>

      <main class="content-area">
        
  <article class="post single">
    <div class="content-area">
      <header class="entry-header">
        <h1 class="entry-title">Blog Navigator Professional posts again</h1>
        <div class="entry-meta">
          <time datetime="2005-02-22T08:15:09&#43;00:00">
            February 22, 2005
          </time>
          
          <span class="author">by Adam Najmanowicz</span>
          
          <span class="reading-time">
            <svg class="reading-time-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
            5 min read
          </span>
        </div>
        
        <div class="entry-categories">
          
          <a href="http://localhost:1314/categories/blog-navigator/" class="category-badge">Blog Navigator</a>
          
          <a href="http://localhost:1314/categories/software-development/" class="category-badge">Software Development</a>
          
          <a href="http://localhost:1314/categories/stardock/" class="category-badge">Stardock</a>
          
        </div>
        
      </header>

      <div class="entry-content">
        <h3 id="security-versus-compatibility-and-functionality-is-removing-features-a-new-course-for-microsoft">Security versus compatibility and functionality. Is removing features a new course for Microsoft?</h3>
<p><a href="http://adam.joeuser.com/articles.asp--AID=66022" title="Originally posted on another site">Originally posted on JoeUser.com</a></p>
<p>Last week it has been brought to my attention that our <a href="http://www.blognavigator.com/">Blog Navigator</a> can no longer post web articles. Alas, this was only a symptom of a much worse disease, but first things first&hellip;</p>
<p>This month in a noble effort of making the Windows platform more secure for us and our (perhaps future) kids ;) Microsoft rolled out <a href="http://www.microsoft.com/security/bulletins/200502_windows.mspx">a new set of updates</a>, among which is this one innocently called <a href="http://www.microsoft.com/technet/security/bulletin/MS05-013.mspx">MS05-013</a> and located in Microsoft Knowledge Base under a mysterious <a href="http://www.microsoft.com/technet/security/bulletin/ms05-013.mspx">KB891781</a>.</p>
<p>You will find more about the update and the horror it caused among the programmers using the control affected by the update on usenet, posts as <a href="http://groups-beta.google.com/group/microsoft.public.inetsdk.programming.dhtml_editing/browse_thread/thread/c4953436aaa87d77/b2b6908f0036fb5f#b2b6908f0036fb5fthe">this</a> and <a href="http://groups-beta.google.com/group/microsoft.public.inetsdk.programming.dhtml_editing/browse_thread/thread/d6d82ab744dadc96/df34c30116dd2c48#df34c30116dd2c48">this</a> are only small sample of the damage. It seems that MS broke quite a few programs while making us more safe.</p>
<p>The effect, saying it bluntly is: <em><strong>IDHTMLEdit has been made useless</strong></em> and <a href="http://www.blognavigator.com/">Blog Navigator</a> fallen prey to that change.</p>
<p>Since <a href="http://msdn.microsoft.com/archive/default.asp?url=/archive/en-us/dnaredcom/html/cncpt.asp">IDHTMLEdit</a> is simply a wrapper around <a href="http://msdn.microsoft.com/library/default.asp?url=/workshop/browser/mshtml/reference/reference.asp">MSHTML</a> editor, I&rsquo;ve examined quite a few approaches and some existing libraries, to fix the issue as fast and with as little modifications to the existing code as possible. After a day of hunting around and testing the existing approaches I&rsquo;ve decided that if I want to retain the control over my code and keep it at a reasonable size, I need to do it myself.</p>
<p>Below is my simplistic (and working) approach to migrating from <a href="http://msdn.microsoft.com/archive/default.asp?url=/archive/en-us/dnaredcom/html/cncpt.asp">DHTML Editing Component</a> to <a href="http://msdn.microsoft.com/library/default.asp?url=/workshop/browser/mshtml/reference/reference.asp">MSHTML</a> editor (for Delphi programmers).</p>
<ol>
<li>I use a <a href="http://www.euromind.com/iedelphi/embeddedwb.htm">TEmbeddedWB</a> as the web browser control wrapper as it offers quite a bit additional functionality. I&rsquo;m assuming you use that instead of the TWebbrowser as well. If you&rsquo;re not, it&rsquo;a not a big problem to extract the functionalty you will need here.</li>
<li>In the DhtmlEdit you operate on the DOM structure and that&rsquo;s the interface the control does not allow you to access any loger and the change thaat makes it useless. The TWebBrowser offers a Document <a href="http://msdn.microsoft.com/library/en-us/automat/htm/chap5_78v9.asp">IDispatch</a> which you can cast on <a href="http://msdn.microsoft.com/library/default.asp?url=/workshop/browser/mshtml/reference/ifaces/document2/document2.asp">IHTMLDocument2</a>. This is exactly the structure you were working on before.</li>
<li>Now the browser control itself does not offer the ExecCommand(&hellip;) functionality. but not all is lost. when you get to the <a href="http://msdn.microsoft.com/library/default.asp?url=/workshop/browser/mshtml/reference/ifaces/document2/document2.asp">IHTMLDocument2</a> interface as described before, you can pretty much do anythng you were doing before by calling its <a href="http://msdn.microsoft.com/workshop/browser/mshtml/reference/ifaces/document2/execcommand.asp">execCommand</a>.</li>
<li>You can also pull ann the formatting data from it by querrying it with its: <a href="http://msdn.microsoft.com/workshop/browser/mshtml/reference/ifaces/document2/querycommandenabled.asp">queryCommandEnabled</a>, <a href="http://msdn.microsoft.com/workshop/browser/mshtml/reference/ifaces/document2/execcommand.asp">execCommand</a>, <a href="http://msdn.microsoft.com/workshop/browser/mshtml/reference/ifaces/document2/querycommandindeterm.asp">queryCommandIndeterm</a>, <a href="http://msdn.microsoft.com/workshop/browser/mshtml/reference/ifaces/document2/querycommandstate.asp">queryCommandState</a>, <a href="http://msdn.microsoft.com/workshop/browser/mshtml/reference/ifaces/document2/querycommandsupported.asp">queryCommandSupported</a>, <a href="http://msdn.microsoft.com/workshop/browser/mshtml/reference/ifaces/document2/querycommandtext.asp">queryCommandText</a> and <a href="http://msdn.microsoft.com/workshop/browser/mshtml/reference/ifaces/document2/querycommandvalue.asp">queryCommandValue</a> methods.</li>
<li>Now the problem is that IDHTMLEdit used numeric values while the Document requires you to use strings. The simplest method is to use a translating table which is what I did:</li>
</ol>
<blockquote>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">type
</span></span><span class="line"><span class="cl">  TMSHtmlCommandTranslation = array [DECMD_BOLD .. DECMD_PROPERTIES] of WideString;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="k">const</span>
</span></span><span class="line"><span class="cl">  <span class="n">MSHtmlCommandTranslation</span> <span class="p">:</span> <span class="n">TMSHtmlCommandTranslation</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;Bold&#39;</span><span class="p">,</span>               <span class="o">//</span><span class="n">DECMD_BOLD</span> <span class="o">=</span> <span class="o">$</span><span class="mi">00001388</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;Copy&#39;</span><span class="p">,</span>               <span class="o">//</span><span class="n">DECMD_COPY</span> <span class="o">=</span> <span class="o">$</span><span class="mi">0000138</span><span class="n">A</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;Cut&#39;</span><span class="p">,</span>                <span class="o">//</span><span class="n">DECMD_CUT</span> <span class="o">=</span> <span class="o">$</span><span class="mi">0000138</span><span class="n">B</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;Delete&#39;</span><span class="p">,</span>             <span class="o">//</span><span class="n">DDECMD_DELETE</span> <span class="o">=</span> <span class="o">$</span><span class="mi">0000138</span><span class="n">C</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_DELETECELLS</span> <span class="o">=</span> <span class="o">$</span><span class="mi">0000138</span><span class="n">D</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_DELETECOLS</span> <span class="o">=</span> <span class="o">$</span><span class="mi">0000138</span><span class="n">E</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_DELETEROWS</span> <span class="o">=</span> <span class="o">$</span><span class="mi">0000138</span><span class="n">F</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;Find&#39;</span><span class="p">,</span>               <span class="o">//</span><span class="n">DDECMD_FINDTEXT</span> <span class="o">=</span> <span class="o">$</span><span class="mi">00001390</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;FontName&#39;</span><span class="p">,</span>           <span class="o">//</span><span class="n">DDECMD_FONT</span> <span class="o">=</span> <span class="o">$</span><span class="mi">00001391</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_GETBACKCOLOR</span> <span class="o">=</span> <span class="o">$</span><span class="mi">00001392</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_GETBLOCKFMT</span> <span class="o">=</span> <span class="o">$</span><span class="mi">00001393</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_GETBLOCKFMTNAMES</span> <span class="o">=</span> <span class="o">$</span><span class="mi">00001394</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_GETFONTNAME</span> <span class="o">=</span> <span class="o">$</span><span class="mi">00001395</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;FontSize&#39;</span><span class="p">,</span>           <span class="o">//</span><span class="n">DDECMD_GETFONTSIZE</span> <span class="o">=</span> <span class="o">$</span><span class="mi">00001396</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_GETFORECOLOR</span> <span class="o">=</span> <span class="o">$</span><span class="mi">00001397</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;CreateLink&#39;</span><span class="p">,</span>         <span class="o">//</span><span class="n">DDECMD_HYPERLINK</span> <span class="o">=</span> <span class="o">$</span><span class="mi">00001398</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;InsertImage&#39;</span><span class="p">,</span>        <span class="o">//</span><span class="n">DDECMD_IMAGE</span> <span class="o">=</span> <span class="o">$</span><span class="mi">00001399</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;Indent&#39;</span><span class="p">,</span>             <span class="o">//</span><span class="n">DDECMD_INDENT</span> <span class="o">=</span> <span class="o">$</span><span class="mi">0000139</span><span class="n">A</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_INSERTCELL</span> <span class="o">=</span> <span class="o">$</span><span class="mi">0000139</span><span class="n">B</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_INSERTCOL</span> <span class="o">=</span> <span class="o">$</span><span class="mi">0000139</span><span class="n">C</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_INSERTROW</span> <span class="o">=</span> <span class="o">$</span><span class="mi">0000139</span><span class="n">D</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_INSERTTABLE</span> <span class="o">=</span> <span class="o">$</span><span class="mi">0000139</span><span class="n">E</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;Italic&#39;</span><span class="p">,</span>             <span class="o">//</span><span class="n">DDECMD_ITALIC</span> <span class="o">=</span> <span class="o">$</span><span class="mi">0000139</span><span class="n">F</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;JustifyCenter&#39;</span><span class="p">,</span>      <span class="o">//</span><span class="n">DDECMD_JUSTIFYCENTER</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">A0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;JustifyLeft&#39;</span><span class="p">,</span>        <span class="o">//</span><span class="n">DDECMD_JUSTIFYLEFT</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">A1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;JustifyRight&#39;</span><span class="p">,</span>       <span class="o">//</span><span class="n">DDECMD_JUSTIFYRIGHT</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">A2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_LOCK_ELEMENT</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">A3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_MAKE_ABSOLUTE</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">A4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_MERGECELLS</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">A5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;InsertOrderedList&#39;</span><span class="p">,</span>  <span class="o">//</span><span class="n">DDECMD_ORDERLIST</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">A6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;Outdent&#39;</span><span class="p">,</span>            <span class="o">//</span><span class="n">DDECMD_OUTDENT</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">A7</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;Paste&#39;</span><span class="p">,</span>              <span class="o">//</span><span class="n">DDECMD_PASTE</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">A8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;Redo&#39;</span><span class="p">,</span>               <span class="o">//</span><span class="n">DDECMD_REDO</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">A9</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_REMOVEFORMAT</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">AA</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;SelectAll&#39;</span><span class="p">,</span>          <span class="o">//</span><span class="n">DDECMD_SELECTALL</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">AB</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_SEND_BACKWARD</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">AC</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_BRING_FORWARD</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">AD</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_SEND_BELOW_TEXT</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">AE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_BRING_ABOVE_TEXT</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">AF</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_SEND_TO_BACK</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">B0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_BRING_TO_FRONT</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">B1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_SETBACKCOLOR</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">B2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_SETBLOCKFMT</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">B3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;FontName&#39;</span><span class="p">,</span>           <span class="o">//</span><span class="n">DDECMD_SETFONTNAME</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">B4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;FontSize&#39;</span><span class="p">,</span>           <span class="o">//</span><span class="n">DDECMD_SETFONTSIZE</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">B5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;ForeColor&#39;</span><span class="p">,</span>          <span class="o">//</span><span class="n">DDECMD_SETFORECOLOR</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">B6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">,</span>                   <span class="o">//</span><span class="n">DDECMD_SPLITCELL</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">B7</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;Underline&#39;</span><span class="p">,</span>          <span class="o">//</span><span class="n">DDECMD_UNDERLINE</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">B8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;Undo&#39;</span><span class="p">,</span>               <span class="o">//</span><span class="n">DDECMD_UNDO</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">B9</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;Unlink&#39;</span><span class="p">,</span>             <span class="o">//</span><span class="n">DDECMD_UNLINK</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">BA</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;InsertUnorderedList&#39;</span><span class="p">,</span><span class="o">//</span><span class="n">DDECMD_UNORDERLIST</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">BB</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;</span><span class="p">);</span>                  <span class="o">//</span><span class="n">DECMD_PROPERTIES</span> <span class="o">=</span> <span class="o">$</span><span class="mi">000013</span><span class="n">BC</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>I store the command values as the controls Tags so now instead of calling:</p>
<blockquote>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">DHTMLEdit.ExecCommand(TControl(Sender).Tag,OLECMDEXECOPT_DODEFAULT);
</span></span></code></pre></td></tr></table>
</div>
</div><p>I simply call:</p>
<blockquote>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">FDocument</span><span class="o">.</span><span class="n">execCommand</span><span class="p">(</span><span class="n">MSHtmlCommandTranslation</span><span class="p">[</span><span class="n">TControl</span><span class="p">(</span><span class="n">Sender</span><span class="p">)</span><span class="o">.</span><span class="n">Tag</span><span class="p">],</span><span class="n">True</span><span class="p">,</span><span class="n">variant</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>where the FDocument is the <a href="http://msdn.microsoft.com/library/default.asp?url=/workshop/browser/mshtml/reference/ifaces/document2/document2.asp">IHTMLDocument2</a> DOM document I extracted from the TWebBrowser for the sake of not having to cast it each time I use it. and instead of:</p>
<blockquote>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">DHTMLEdit.QueryStatus(TControl(Sender).Tag);
</span></span></code></pre></td></tr></table>
</div>
</div><p>I can now use:</p>
<blockquote>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">FDocument.queryCommandValue(MSHtmlCommandTranslation[TControl(Sender).Tag]);
</span></span><span class="line"><span class="cl"> FDocument.queryCommandEnabled(MSHtmlCommandTranslation[TControl(Sender).Tag]);
</span></span></code></pre></td></tr></table>
</div>
</div><p>this allowed me to migrate away from <a href="http://msdn.microsoft.com/archive/default.asp?url=/archive/en-us/dnaredcom/html/cncpt.asp">DHTML Editing Component</a> within one day after shunning all other options).</p>
<p>One thing that was pretty indispensible for <a href="http://msdn.microsoft.com/archive/default.asp?url=/archive/en-us/dnaredcom/html/cncpt.asp">DHTML Editing Component</a> was that it called me back evary time a blok formatting was changed, it had this useful <em>OnDisplayChanged</em> event which was summoned every time the UI needed updating. That&rsquo;s where <a href="http://www.euromind.com/iedelphi/embeddedwb.htm">TEmbeddedWB</a> comes handy it implements a</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="kd">function</span><span class="w"> </span><span class="nb">UpdateUI</span><span class="err">:</span> <span class="n">HRESULT</span><span class="p">;</span> <span class="n">stdcall</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>which than triggers the <em>OnUpdateUI</em> event, which for our needs does exactly the save what the <em>OnDisplayChanged</em> event did. so you can simply call your previous OnDisplayChanged event with the numerical querries remapped to strings and&hellip; with minimal effort you have your control fully migrated to the <a href="http://msdn.microsoft.com/library/default.asp?url=/workshop/browser/mshtml/reference/reference.asp">MSHTML</a> editor.</p>
<p>So&hellip; this post is the first post made with the updated <a href="http://www.blognavigator.com/">Blog Navigator</a> with its poat editong brought back to normal functionality.</p>

      </div>

      <footer class="entry-footer">
        

        <nav class="post-navigation">
          
          <div class="nav-previous">
            <a href="/2005/02/14/how-big-is-that-thing-anyway-by-adam-najmanowicz/">&laquo; How big is that thing anyway?</a>
          </div>
          
          
          <div class="nav-next">
            <a href="/2005/03/06/making-icons-with-transparent-background-even-from-flat-bitmaps-by-adam-najmanowicz/">Making icons with transparent background (even from flat bitmaps) &raquo;</a>
          </div>
          
        </nav>
      </footer>

      
<div class="comments">
  <h2 class="comments-title">Comments</h2>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = "http://localhost:1314/2005/02/22/blog-navigator-professional-posts-again-by-adam-najmanowicz/";
      this.page.identifier = "/2005/02/22/blog-navigator-professional-posts-again-by-adam-najmanowicz/";
      this.page.identifier = '686497670';
    };
    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://codality.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

    </div>
  </article>

      </main>
    </div>
    <footer class="site-footer">
      <div class="footer-inner">
  <p>&copy; 1999-2026 - <a href="/">Adam Najmanowicz</a></p>
  
</div>

    </footer>
  </div>
  <button class="back-to-top" id="back-to-top" aria-label="Back to top" title="Back to top">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"/></svg>
  </button>
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.highlight').forEach(function(block) {
      block.style.position = 'relative';
      var btn = document.createElement('button');
      btn.className = 'copy-btn';
      btn.setAttribute('aria-label', 'Copy code');
      btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>';
      block.appendChild(btn);
      btn.addEventListener('click', function() {
        var code = block.querySelector('td:last-child code') || block.querySelector('code');
        if (code) {
          navigator.clipboard.writeText(code.textContent).then(function() {
            btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>';
            setTimeout(function() {
              btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>';
            }, 2000);
          });
        }
      });
    });
  });
  </script>
  <script>
  (function() {
    var btn = document.getElementById('back-to-top');
    if (!btn) return;
    var visible = false;
    window.addEventListener('scroll', function() {
      var shouldShow = window.scrollY > 400;
      if (shouldShow !== visible) {
        visible = shouldShow;
        btn.classList.toggle('visible', visible);
      }
    }, { passive: true });
    btn.addEventListener('click', function() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  })();
  </script>
  <div class="lightbox-overlay" id="lightbox">
    <button class="lightbox-close" id="lightbox-close" aria-label="Close lightbox">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
    </button>
    <div class="lightbox-content" id="lightbox-content"></div>
  </div>
  <script>
  (function() {
    var overlay = document.getElementById('lightbox');
    var content = document.getElementById('lightbox-content');
    var closeBtn = document.getElementById('lightbox-close');
    var imgExts = /\.(jpe?g|png|gif|webp|svg|bmp|avif)(\?.*)?$/i;
    var vidExts = /\.(mp4|webm|ogg)(\?.*)?$/i;

    function open(href) {
      content.innerHTML = '';
      if (imgExts.test(href)) {
        var img = document.createElement('img');
        img.src = href;
        img.alt = '';
        content.appendChild(img);
      } else if (vidExts.test(href)) {
        var vid = document.createElement('video');
        vid.src = href;
        vid.controls = true;
        vid.autoplay = true;
        content.appendChild(vid);
      } else {
        return false;
      }
      overlay.classList.add('active');
      document.body.style.overflow = 'hidden';
      return true;
    }

    function close() {
      overlay.classList.remove('active');
      document.body.style.overflow = '';
      var vid = content.querySelector('video');
      if (vid) vid.pause();
    }

    document.addEventListener('click', function(e) {
      var link = e.target.closest('a[href]');
      if (!link) return;
      var href = link.getAttribute('href');
      if (imgExts.test(href) || vidExts.test(href)) {
        e.preventDefault();
        open(href);
      }
    });

    closeBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      close();
    });

    overlay.addEventListener('click', function(e) {
      if (e.target === overlay) close();
    });

    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && overlay.classList.contains('active')) close();
    });
  })();
  </script>
  <script id="dsq-count-scr" src="https://codality.disqus.com/count.js" async></script>
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    var mermaidBlocks = document.querySelectorAll('pre > code.language-mermaid');
    if (mermaidBlocks.length > 0) {
      var s = document.createElement('script');
      s.src = 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js';
      s.onload = function() {
        var mermaidTheme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default';
        mermaid.initialize({ startOnLoad: false, theme: mermaidTheme });
        mermaidBlocks.forEach(function(block) {
          var pre = block.parentElement;
          var div = document.createElement('div');
          div.className = 'mermaid';
          div.textContent = block.textContent;
          pre.parentNode.replaceChild(div, pre);
        });
        mermaid.run();
      };
      document.head.appendChild(s);
    }
  });
  </script>
</body>
</html>
